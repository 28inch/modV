var modV=function(f){function C(a,b){b=b.toUpperCase();do if(a.nodeName===b)return a;while(a=a.parentNode);return!1}function F(){var a=document.createElement("select"),b=document.createElement("optgroup");b.label="Blend Modes";"normal multiply overlay darken lighten color-dodge color-burn hard-light soft-light difference exclusion hue saturation color luminosity".split(" ").forEach(function(a){var d=document.createElement("option");d.value=a;d.textContent=a.replace("-"," ");d.textContent=d.textContent.charAt(0).toUpperCase()+ d.textContent.slice(1);b.appendChild(d)});var e=document.createElement("optgroup");e.label="Composite Modes";"clear copy destination source-over destination-over source-in destination-in source-out destination-out source-atop destination-atop xor lighter".split(" ").forEach(function(a){var b=document.createElement("option");b.value=a;b.textContent=a.replace("-"," ");b.textContent=b.textContent.charAt(0).toUpperCase()+b.textContent.slice(1);e.appendChild(b)});a.appendChild(b);a.appendChild(e);return a} (function(){for(var a=0,b=["ms","moz","webkit","o"],e=0;e<b.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[b[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[e]+"CancelAnimationFrame"]||window[b[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,d){var z=(new Date).getTime(),e=Math.max(0,16-(z-a)),g=window.setTimeout(function(){b(z+e)},e);a=z+e;return g});window.cancelAnimationFrame||(window.cancelAnimationFrame= function(a){clearTimeout(a)})})();Object.size=function(a){var b=0,e;for(e in a)a.hasOwnProperty(e)&&b++;return b};Array.contains=function(a,b){console.log(a,b);return-1<b.indexOf(a)};var k=[],h={},g=this,t=document.createElement("video"),q=!1;this.meyda;this.meydaFeatures=[];this.addMeydaFeature=function(a){if(Array.contains(a,g.meydaFeatures))return!1;g.meydaFeatures.push(a);return!0};"function"==typeof window.Meyda&&(q=!0,console.info("meyda detected, expanded audio analysis available.","Use this.meyda to access from console.")); t.autoplay=!0;t.muted=!0;this.options="undefined"!==typeof f?f:{};this.options.controlDomain||(this.options.controlDomain=location.protocol+"//"+location.host);window.addEventListener("message",function(a){if(a.origin===g.options.controlDomain){console.log(a.data);if("variable"==a.data.type){var b;switch(a.data.varType){case "float":b=parseFloat(a.data.payload);break;case "int":b=parseInt(a.data.payload);break;default:b=a.data.payload}h[a.data.modName][a.data.name]=b}"image"==a.data.type&&(h[a.data.modName][a.data.name].src= a.data.payload);"video"==a.data.type&&(h[a.data.modName][a.data.name].src=a.data.payload,h[a.data.modName][a.data.name].load(),h[a.data.modName][a.data.name].play());"multiimage"==a.data.type&&(a.data.wipe&&(h[a.data.modName][a.data.name].length=0),a.data.payload.forEach(function(b){var d=new Image;d.src=b;h[a.data.modName][a.data.name].push(d)}));"modBlend"==a.data.type&&(h[a.data.modName].info.blend=a.data.payload);"modOpacity"==a.data.type&&(h[a.data.modName].info.alpha=a.data.payload);if("setOrderUp"== a.data.type){var e=-1;k.forEach(function(b,d){a.data.modName==b&&(e=d)});0<e&&(--e,g.setModOrder(a.data.modName,e))}"setOrderFromElements"==a.data.type&&(e=-1,k.forEach(function(b,d){a.data.y==b&&(e=d)}),0<e&&g.setModOrder(a.data.x,e));"check"==a.data.type&&(h[a.data.modName].info.disabled=a.data.payload?!1:!0);"global"==a.data.type&&"clearing"==a.data.name&&(g.clearing=a.data.payload?!0:!1)}},!1);var l=window.open("","_blank","width=480.96, height="+screen.height+", location=yes, menubar=yes, left="+ screen.width/100*66.6);f=function(a){return"You sure about that, you drunken mess?"};if(this.options.previewWindow){var u=window.open("","_blank","width=640, height=480, location=no, menubar=no, left=0"),n=document.createElement("canvas"),G=n.getContext("2d");u.document.body.style.margin="0px";n.width=640;n.height=480;u.onbeforeunload=f;u.document.body.appendChild(n)}l.onbeforeunload=f;window.onbeforeunload=f;f=document.createElement("link");f.type="text/css";f.rel="stylesheet";f.href="http://brkbrkbrk.com/dev/modV/control-stylesheet.css"; l.document.getElementsByTagName("head")[0].appendChild(f);l.window.receiveMessage=function(a){};l.window.addEventListener("message",l.window.receiveMessage,!1);window.addEventListener("beforeunload",function(){try{l.close(),u.close()}catch(a){}},!1);var v=void 0,A=[],m=void 0,r=void 0,w=void 0,x=void 0,B=!1;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia;navigator.getUserMedia({audio:{optional:[{googNoiseSuppression:!1}, {googEchoCancellation:!1},{googEchoCancellation2:!1},{googAutoGainControl:!1},{googNoiseSuppression2:!1},{googHighpassFilter:!1},{googTypingNoiseDetection:!1}]},video:{optional:[{googNoiseSuppression:!1},{googEchoCancellation:!1},{googEchoCancellation2:!1},{googAutoGainControl:!1},{googNoiseSuppression2:!1},{googHighpassFilter:!1},{googTypingNoiseDetection:!1}]}},function(a){t.src=window.webkitURL.createObjectURL(a);m=new window.AudioContext;r=m.createAnalyser();v=m.createScriptProcessor(1024,1,1); v.onaudioprocess=function(){r.getByteTimeDomainData(A)};x=m.createGain();x.gain.value=0;w=m.createMediaStreamSource(a);w.connect(x);x.connect(m.destination);q&&(g.meyda=new Meyda(m,w,512));w.connect(r);r.connect(v);v.connect(m.destination);A=FFTData=new Uint8Array(r.frequencyBinCount);B=!0},function(){console.log("Error setting up WebAudio - please make sure you've allowed modV access.")});this.canvas=void 0;this.clearing=!0;this.setCanvas=function(a){if("CANVAS"!=a.nodeName)return console.error("modV: setCanvas was not supplied with a CANVAS element."), !1;this.canvas=a;this.context=a.getContext("2d");window.addEventListener("resize",function(){g.canvas.width=window.innerWidth;g.canvas.height=window.innerHeight;for(mod in h)"function"==typeof mod.init&&mod.init(g.canvas,g.context)},!1);return!0};this.setDimensions=function(a,b){if("undefined"===typeof a&&"undefined"===typeof b)console.error("modV: setDimensions was not supplied anything!");else{if("number"!==typeof a){console.error("modV: setDimensions was not supplied with a number type.");return}if("number"!== typeof b){console.error("modV: setDimensions was not supplied with a number type.");return}}"undefined"===typeof a&&"undefined"!==typeof b?this.canvas.width=this.canvas.height=b:"undefined"!==typeof a&&"undefined"===typeof b?this.canvas.width=this.canvas.height=a:(this.canvas.width=a,this.canvas.height=b)};f=document.createElement("fieldset");var p=document.createElement("legend");p.textContent="Global";f.appendChild(p);p=document.createElement("label");p.textContent="Clearing ";var y=document.createElement("input"); y.type="checkbox";y.checked=!1;y.addEventListener("change",function(){l.window.opener.postMessage({type:"global",name:"clearing",payload:this.checked},g.options.controlDomain)});p.appendChild(y);f.appendChild(p);f.appendChild(document.createElement("br"));l.document.body.appendChild(f);this.registerMod=function(a){a=new a;"function"===typeof a.init&&a.init(this.canvas,this.context);"blend"in a.info||(a.info.blend="normal");"alpha"in a.info||(a.info.alpha=1);a.info.disabled=!0;q&&"meyda"in a.info? a.info.meyda.forEach(this.addMeydaFeature):!q&&"meyda"in a.info&&console.warn("Whilst registering the module '"+a.info.name+"', modV detected it requests Meyda which has not been included on the page. You may encounter problems using this module without Meyda.");var b=document.createElement("fieldset"),e=null;b.addEventListener("drop",function(a){a.preventDefault();var b=C(a.target,"fieldset");b.style.backgroundColor="white";console.log(b);var c=b.dataset.name;a=a.dataTransfer.getData("text");var d= l.document.querySelector('fieldset[data-name="'+a+'"]');d.parentNode.insertBefore(d,b);l.window.opener.postMessage({type:"setOrderFromElements",x:a,y:c},g.options.controlDomain);console.log(d)},!1);b.addEventListener("dragover",function(a){a.preventDefault();e=C(a.target,"fieldset");try{e.style.backgroundColor="green"}catch(b){}},!1);b.addEventListener("dragleave",function(a){a.preventDefault();e.style.backgroundColor="white"},!1);b.dataset.name=a.info.name;b.style.position="relative";var c=document.createElement("legend"); c.textContent=a.info.name;c.style.fontSize="20px";b.appendChild(c);c=document.createElement("label");c.textContent="Enabled ";document.createElement("br");var d=document.createElement("input");d.type="checkbox";d.checked=!1;d.addEventListener("change",function(){l.window.opener.postMessage({type:"check",modName:a.info.name,payload:this.checked},g.options.controlDomain)});c.appendChild(d);b.appendChild(c);b.appendChild(document.createElement("br"));c=document.createElement("button");c.textContent= "UP";c.addEventListener("click",function(){l.window.opener.postMessage({type:"setOrderUp",modName:a.info.name},g.options.controlDomain)});b.appendChild(c);b.appendChild(document.createElement("br"));d=document.createElement("input");d.type="range";c=document.createElement("label");c.textContent="Opacity ";d.min=0;d.max=1;d.step=.01;d.value=a.info.alpha;d.addEventListener("input",function(){l.window.opener.postMessage({type:"modOpacity",modName:a.info.name,payload:this.value},g.options.controlDomain)}); c.appendChild(d);b.appendChild(c);b.appendChild(document.createElement("br"));d=F();c=document.createElement("label");c.textContent="Blending ";d.addEventListener("change",function(){l.window.opener.postMessage({type:"modBlend",modName:a.info.name,payload:this.value},g.options.controlDomain)});c.appendChild(d);b.appendChild(c);b.appendChild(document.createElement("br"));c=document.createElement("div");c.classList.add("mover");c.style.width="50px";c.style.height="50px";c.style.borderRadius="50%";c.style.backgroundColor= "red";c.style.textAlign="center";c.style.fontSize="44px";c.style.color="white";c.style.position="absolute";c.style.right="-8px";c.style.top="-8px";c.draggable=!0;c.addEventListener("dragstart",function(a){a.dataTransfer.setData("text",a.target.parentNode.dataset.name)},!1);c.addEventListener("dragend",function(a){},!1);b.appendChild(c);"controls"in a.info&&a.info.controls.forEach(function(c){var d=c.variable,e=document.createElement("label");e.textContent=c.label+" ";b.appendChild(document.createElement("hr")); if("video"==c.type){var h=new Image;h.src=a[d].src;b.addEventListener("dragover",function(a){a.preventDefault();this.classList.add("dragover")});b.addEventListener("dragend",function(a){a.preventDefault();this.classList.remove("dragover")});b.addEventListener("drop",function(b){b.preventDefault();this.classList.remove("dragover");(b=b.dataTransfer.files[0])&&b.type.match(/video.*/)&&(b=window.URL.createObjectURL(b),l.window.opener.postMessage({type:"video",modName:a.info.name,name:d,payload:b},g.options.controlDomain), a[d].play())});e.appendChild(h)}else if("image"==c.type)h=new Image,h.src=a[d].src,b.addEventListener("dragover",function(a){a.preventDefault();this.classList.add("dragover")}),b.addEventListener("dragend",function(a){a.preventDefault();this.classList.remove("dragover")}),b.addEventListener("drop",function(b){b.preventDefault();this.classList.remove("dragover");(b=b.dataTransfer.files[0])&&b.type.match(/image.*/)&&(b=window.URL.createObjectURL(b),l.window.opener.postMessage({type:"image",modName:a.info.name, name:d,payload:b},g.options.controlDomain),h.src=b)}),e.appendChild(h);else if("multiimage"==c.type)h=new Image,b.addEventListener("dragover",function(a){a.preventDefault();this.classList.add("dragover")}),b.addEventListener("dragend",function(a){a.preventDefault();this.classList.remove("dragover")}),b.addEventListener("drop",function(b){b.preventDefault();var c=b.altKey;this.classList.remove("dragover");b=b.dataTransfer.files;for(var e=[],f=0,k;k=b[f];f++)k&&k.type.match(/image.*/)&&(k=window.URL.createObjectURL(k), h.src=k,e.push(k));l.window.opener.postMessage({type:"multiimage",modName:a.info.name,name:d,payload:e,wipe:c},g.options.controlDomain)}),e.appendChild(h);else{if("checkbox"==c.type){var k="checkbox",f=document.createElement("input");f.type=k;"checked"in c&&(f.checked=c.checked);f.addEventListener("change",function(){l.window.opener.postMessage({type:"variable",varType:c.varType,modName:a.info.name,name:d,payload:f.checked},g.options.controlDomain)})}else k=c.type,f=document.createElement("input"), f.type=k,"min"in c&&(f.min=c.min),"max"in c&&(f.max=c.max),"step"in c&&(f.step=c.step),"varType"in c||(f.varType="string"),f.value=a[d],f.addEventListener("input",function(){"append"in c?l.window.opener.postMessage({type:"variable",varType:c.varType,modName:a.info.name,name:d,payload:f.value+c.append},g.options.controlDomain):l.window.opener.postMessage({type:"variable",varType:c.varType,modName:a.info.name,name:d,payload:f.value},g.options.controlDomain)});e.appendChild(f)}b.appendChild(e);b.appendChild(document.createElement("br"))}); l.document.body.appendChild(b);c=h[a.info.name]=a;this.setModOrder(a.info.name,Object.size(h));return c};this.setModOrder=function(a,b){if("undefined"==k[b])k[b]=a;else{var e=-1;k.forEach(function(b,c){a==b&&(e=c)});-1<e&&k.splice(e,1);k.splice(b,0,a);k.forEach(function(a,b){h[a].info.order=b;l.document.querySelector('fieldset[data-name="'+a+'"]').getElementsByClassName("mover")[0].textContent=b})}var c=l.document.body,d=c.querySelectorAll("fieldset[data-name]"),f=[],g;for(g in d)1==d[g].nodeType&& f.push(d[g]);f.sort(function(a,b){return h[a.dataset.name].info.order-h[b.dataset.name].info.order});for(g=0;g<f.length;++g)c.appendChild(f[g]);return k};this.drawFrame=function(a){if(B){this.clearing&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height);for(var b=0;b<k.length;b++)"object"!==typeof h[k[b]]||h[k[b]].info.disabled||0==h[k[b]].info.alpha||(this.context.save(),this.context.globalAlpha=h[k[b]].info.alpha,"normal"!=h[k[b]].info.blend&&(this.context.globalCompositeOperation= h[k[b]].info.blend),h[k[b]].draw(this.canvas,this.context,A,t,a),this.context.restore());this.options.previewWindow&&G.drawImage(this.canvas,0,0,n.width,n.height)}};var D,E=function(){requestAnimationFrame(E);if(q&&B)try{D=g.meyda.get(g.meydaFeatures)}catch(a){}g.drawFrame(D)};this.start=function(){requestAnimationFrame(E)}};